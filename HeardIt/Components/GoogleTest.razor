@using Google.Cloud.TextToSpeech.V1
@using Google.Protobuf.Collections

@if (_base64 != null)
{
    <audio controls src="@audioBase"></audio>
}

@code {

    [Parameter]
    public TextToSpeechClient? Client { get; set; }

    [Parameter]
    public VoiceSelectionParams VoiceSelectionParams { get; set; }

    AudioConfig _audioConfig { get; set; }
    string? _base64 { get; set; }
    string? audioBase { get; set; }

    [Parameter]
    public string? inputString { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (inputString != null && Client != null && VoiceSelectionParams != null)
        {
            _audioConfig = new AudioConfig {AudioEncoding = AudioEncoding.Mp3};
            var input = new SynthesisInput {Text = inputString};
            var response = await Client.SynthesizeSpeechAsync(input, VoiceSelectionParams, _audioConfig);
            _base64 = response.AudioContent.ToBase64();
            audioBase = "data:audio/mp3;base64," + _base64;
            StateHasChanged();
        }
    }

}